---
format_version: '11'
default_step_lib_source: https://github.com/bitrise-io/bitrise-steplib.git
project_type: ios
workflows:
  pull-request:
    description: ''
    steps:
    - git-clone@8: {}
    - restore-spm-cache@1: {}
    - script@1:
        inputs:
          - content: |-
              #!/usr/bin/env bash set -ex

              rbenv local 3.3.5
    - brew-install@0:
        inputs:
          - brewfile_path: $BITRISE_SOURCE_DIR/ExampleApp/Brewfile
          - cache_enabled: "yes"
          - upgrade: "no"
          - use_brewfile: "yes"
    - fastlane@3:
        inputs:
          - work_dir: $BITRISE_SOURCE_DIR/ExampleApp
          - connection: "off"
          - update_fastlane: "false"
          - lane: generate_assets
        title: Generate project assets
    - fastlane@3:
        inputs:
          - work_dir: $BITRISE_SOURCE_DIR/ExampleApp
          - connection: "off"
          - update_fastlane: "false"
          - lane: generate_project
        title: Generate project configs
    - fastlane@3:
        inputs:
          - work_dir: $BITRISE_SOURCE_DIR/ExampleApp
          - connection: "off"
          - update_fastlane: "false"
          - lane: build_project
        title: Build project
    - xcode-test@4.0:
        inputs:
          - project_path: $BITRISE_SOURCE_DIR/ExampleApp/App/App.xcodeproj
          - scheme: AppTests
          - destination: platform=iOS,name=iPhone 14 Plus,OS=latest
          - generate_code_coverage_files: "yes"
          - xcodebuild_options: "-skipPackagePluginValidation"
    - save-spm-cache@1: {}
    - generate-xcode-html-report: {}
    - deploy-to-bitrise-io:
  release:
    description: ''
    steps:
    - git-clone@8: {}
    - cache-pull@2: {}
    - script@1:
        inputs:
          - content: |-
              #!/usr/bin/env bash set -ex

              rbenv local 3.3.5
    - brew-install@0:
        inputs:
          - brewfile_path: $BITRISE_SOURCE_DIR/ExampleApp/Brewfile
          - cache_enabled: "yes"
          - upgrade: "no"
          - use_brewfile: "yes"
    - fastlane@3:
        inputs:
          - work_dir: $BITRISE_SOURCE_DIR/ExampleApp
          - connection: "off"
          - update_fastlane: "false"
          - lane: generate_assets
        title: Generate project assets
    - fastlane@3:
        inputs:
          - work_dir: $BITRISE_SOURCE_DIR/ExampleApp
          - connection: "off"
          - update_fastlane: "false"
          - lane: generate_project
        title: Generate project configs
    - fastlane@3:
        inputs:
          - work_dir: $BITRISE_SOURCE_DIR/ExampleApp
          - connection: "off"
          - update_fastlane: "false"
          - lane: build_project
        title: Build project
    - script@1:
        inputs:
        - content: |-
            #!/usr/bin/env bash set -ex

            npx standard-version -t "" $(if [ ! -z $RELEASE_AS ]; then echo "--release-as $RELEASE_AS"; fi)
    - script@1:
        inputs:
        - content: |-
            #!/usr/bin/env bash set -ex

            git push origin $BITRISE_GIT_BRANCH
            git push --tags
    - cache-push@2: {}
meta:
  bitrise.io:
    stack: osx-xcode-16.2.x
    machine_type_id: g2-m1.4core
trigger_map:
- pull_request_source_branch: "*"
  workflow: pull-request
  pull_request_target_branch: master
app:
  envs:
    - GIT_AUTHOR_NAME: Sean Gomes-Luis
    - GIT_AUTHOR_EMAIL: gomesluissean@gmail.com
    - GIT_COMMITTER_NAME: Sean Gomes-Luis
    - GIT_COMMITTER_EMAIL: gomesluissean@gmail.com
